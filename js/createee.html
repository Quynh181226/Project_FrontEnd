<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/createTest.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/createTest.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>Add/edit question</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
        }

        .navbar {
            background-color: #333;
            padding: 15px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
        }

        .navbar a:hover {
            background-color: #555;
        }

        #mainContent {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        #mainContent h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-control,
        .form-select {
            margin-bottom: 15px;
        }

        .row div {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            border: none;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .table {
            margin-top: 20px;
        }

        .table th,
        .table td {
            vertical-align: middle;
            text-align: center;
        }

        .table th {
            background-color: #333;
            color: white;
        }

        .table .btn {
            margin: 0 5px;
        }

        .modal-content {
            padding: 20px;
            border-radius: 5px;
        }

        .modal-header {
            border-bottom: none;
            padding-bottom: 0;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .modal-body {
            padding: 10px 0;
        }

        .answerItem {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .answerItem .form-check-input {
            margin-top: 0;
        }

        .btnDelete {
            color: red;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
        }

        .btn-dark {
            background-color: #333;
            border: none;
        }

        .btn-dark:hover {
            background-color: #444;
        }

        .modal-footer {
            border-top: none;
            padding-top: 0;
        }

        .footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        .input-group {
            display: flex;
            align-items: center;
            position: relative;
        }

        .btnDelete {
            position: absolute;
            right: 10px;
            top: 6px;
        }

        .form-control {
            margin: 0;
        }

        .input-group-text {
            padding: 10px;
        }

        .btnAddSave {
            display: flex;
            justify-content: space-between;
        }

        .modal {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .input-group {
            display: flex;
            margin-bottom: 5px;
        }

        .error-message {
            display: none;
            color: red;
            font-size: 14px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <header>
        <div class="navbar">
            <div class="logo">QuizzForge</div>
            <nav>
                <a href="#" id="category1">Category</a>
                <a href="#" id="the-test1" class="active">The test</a>
                <a href="#" id="log-out1">Log out</a>
            </nav>
        </div>
    </header>

    <!-- Main -->
    <main>
        <div id="mainContent">
            <h2>Create the test</h2>
            <div id="testNameContainer" class="mb-3">
                <label for="testName" class="form-label">Test name</label>
                <input type="text" id="testName" class="form-control" placeholder="Input test">
                <small class="error-message text-danger d-block" id="name-error-empty">Test name cannot be empty</small>
                <small class="error-message text-danger d-block" id="name-error-length">Test name must be between 3 and 50 characters</small>
                <small class="error-message text-danger d-block" id="name-error-duplicate">Test name already exists</small>
            </div>
            <div class="row">
                <div class="CateSelect">
                    <label class="form-label">Category</label>
                    <select id="category-test" class="form-select"></select>
                    <small class="error-message text-danger d-block" id="category-error-empty">Please select a category</small>
                </div>
                <div>
                    <label for="time" class="form-label">Time(minutes)</label>
                    <input type="number" id="time" class="form-control" min="1">
                    <small class="error-message text-danger d-block" id="time-error-positive">Time must be greater than 0</small>
                    <small class="error-message text-danger d-block" id="time-error-max">Time must be less than or equal to 120 minutes</small>
                </div>
            </div>
            <h3>Question Management</h3>
            <small class="error-message text-danger d-block" id="question-error-min">Test must have at least 1 question</small>
            <div class="btnAddSave">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#questionModal">Add question</button>
                <button class="btn btn-primary" id="btn-save-test">Save</button>
            </div>
            <table class="table table-bordered" id="table">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Question</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="test-list-question"></tbody>
            </table>
        </div>
    </main>

    <!-- Modal Add/Edit Question -->
    <div class="modal fade" id="questionModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Add/edit question</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label">Question</label>
                    <input type="text" id="content-question" class="form-control" placeholder="Input question">
                    <small class="error-message text-danger d-block" id="question-error-empty">Question cannot be empty</small>
                    <small class="error-message text-danger d-block" id="question-error-length">Question must be between 3 and 100 characters</small>

                    <label class="form-label mt-3">Answer</label>
                    <div id="answerList"></div>
                    <small class="error-message text-danger d-block" id="answer-error-min">Question must have at least 2 answers</small>
                    <small class="error-message text-danger d-block" id="answer-error-empty">Answer cannot be empty</small>
                    <small class="error-message text-danger d-block" id="answer-error-length">Answer must be between 3 and 100 characters</small>
                    <small class="error-message text-danger d-block" id="answer-error-correct">Question must have at least 1 correct answer</small>

                    <button class="btn btn-dark mt-2" id="addAnswer">Add answer</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-question">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Confirm Delete Question -->
    <div class="modal fade" id="deleteQuestionModal" tabindex="-1" aria-labelledby="deleteQuestionModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteQuestionModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this question?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteQuestion">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>© 2025 QuizzForge. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <script>
        // Khai báo biến
        const categoryEl = document.querySelector("#category1");
        const theTestEl = document.querySelector("#the-test1");
        const logOutEl = document.querySelector("#log-out1");
        const testNameEl = document.getElementById("testName");
        const categoryTestEl = document.getElementById("category-test");
        const timeEl = document.getElementById("time");
        const btnSaveTestEl = document.getElementById("btn-save-test");
        const contentQuestionEl = document.getElementById("content-question");
        const addAnswerEl = document.getElementById("addAnswer");
        const answerListEl = document.getElementById("answerList");
        const saveQuestionEl = document.getElementById("save-question");
        const testListQuestionEl = document.getElementById("test-list-question");

        let testList = JSON.parse(localStorage.getItem("list-test")) || [];
        let questionList = [];
        let test = {
            id: -1,
            testName: "",
            categoryId: -1,
            playTime: 0,
            playAmount: 0,
            questions: []
        };
        let question = {
            content: "",
            answers: []
        };
        let editIndex = -1;

        // Kiểm tra nếu đang chỉnh sửa bài test
        const testEdit = JSON.parse(localStorage.getItem("testEdit") || "null");
        if (testEdit) {
            test = testEdit;
            document.querySelector("h2").textContent = "Edit the test";
            testNameEl.value = test.testName;
            categoryTestEl.value = test.categoryId;
            timeEl.value = test.playTime;
            questionList = test.questions || [];
            renderTestListQuestion();
        }

        // Function lưu dữ liệu vào localStorage
        function saveLocal() {
            localStorage.setItem("list-test", JSON.stringify(testList));
        }

        // Function render danh mục vào select
        function renderCategory() {
            const categories = JSON.parse(localStorage.getItem("arrCategories") || "[]");
            let stringHTML = '<option value="" disabled selected>Select category</option>';
            for (let i = 0; i < categories.length; i++) {
                stringHTML += `
                    <option value="${categories[i].id}">
                        ${categories[i].emoji} ${categories[i].name}
                    </option>
                `;
            }
            categoryTestEl.innerHTML = stringHTML;
        }
        renderCategory();

        // Lắng nghe sự kiện thay đổi input
        testNameEl.addEventListener("input", function (e) {
            test.testName = e.target.value;
        });

        categoryTestEl.addEventListener("change", function (e) {
            test.categoryId = +e.target.value;
        });

        timeEl.addEventListener("change", function (e) {
            test.playTime = +e.target.value;
        });

        contentQuestionEl.addEventListener("input", function (e) {
            question.content = e.target.value;
        });

        // Function render danh sách câu trả lời
        function renderAnswers() {
            let answerHtml = "";
            for (let i = 0; i < question.answers.length; i++) {
                answerHtml += `
                    <div id="input-group-answer" style="position: relative;">
                        <div class="input-group">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 checkbox-answer" type="checkbox" 
                                    ${question.answers[i].isCorrected ? "checked" : ""} 
                                    aria-label="Checkbox for following text input" id="answer-${i}">
                            </div>
                            <input type="text" class="form-control input-answer" placeholder="Input answer" 
                                value="${question.answers[i].answer}">
                        </div>
                        <button class="btnDelete btn-del-answer"><img src="../assets/garbage.png"></button>
                    </div>
                `;
            }
            answerListEl.innerHTML = answerHtml;

            const inputAnswers = document.querySelectorAll(".input-answer");
            for (let i = 0; i < inputAnswers.length; i++) {
                inputAnswers[i].addEventListener("input", function (e) {
                    question.answers[i].answer = e.target.value;
                });
            }

            const checkboxAnswers = document.querySelectorAll(".checkbox-answer");
            for (let i = 0; i < checkboxAnswers.length; i++) {
                checkboxAnswers[i].addEventListener("change", function (e) {
                    question.answers[i].isCorrected = e.target.checked;
                });
            }

            const btnDelAnswers = document.querySelectorAll(".btn-del-answer");
            for (let i = 0; i < btnDelAnswers.length; i++) {
                btnDelAnswers[i].addEventListener("click", function () {
                    question.answers.splice(i, 1);
                    renderAnswers();
                });
            }
        }

        // Thêm câu trả lời mới
        addAnswerEl.addEventListener("click", function () {
            question.answers.push({
                answer: "",
                isCorrected: false
            });
            renderAnswers();
        });

        // Function render danh sách câu hỏi
        function renderTestListQuestion() {
            let testListQuestionHtml = "";
            for (let i = 0; i < questionList.length; i++) {
                testListQuestionHtml += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${questionList[i].content}</td>
                        <td>
                            <button class="btn-edit-question" data-index="${i}">Edit</button>
                            <button class="btn-del-question" data-index="${i}">Xoa</button>
                        </td>
                    </tr>
                `;
            }
            testListQuestionEl.innerHTML = testListQuestionHtml;

            const btnEditQuestions = document.querySelectorAll(".btn-edit-question");
            for (let i = 0; i < btnEditQuestions.length; i++) {
                btnEditQuestions[i].addEventListener("click", function (e) {
                    const index = +e.target.getAttribute("data-index");
                    question = {
                        content: questionList[index].content,
                        answers: []
                    };
                    for (let j = 0; j < questionList[index].answers.length; j++) {
                        question.answers.push({
                            answer: questionList[index].answers[j].answer,
                            isCorrected: questionList[index].answers[j].isCorrected
                        });
                    }
                    editIndex = index;
                    contentQuestionEl.value = question.content;
                    renderAnswers();
                    const modalElement = document.getElementById("questionModal");
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();
                });
            }

            const btnDelQuestions = document.querySelectorAll(".btn-del-question");
            for (let i = 0; i < btnDelQuestions.length; i++) {
                btnDelQuestions[i].addEventListener("click", function (e) {
                    const index = +e.target.getAttribute("data-index");
                    const modalElement = document.getElementById("deleteQuestionModal");
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();

                    document.getElementById("confirmDeleteQuestion").onclick = function () {
                        questionList.splice(index, 1);
                        renderTestListQuestion();
                        modal.hide();
                    };
                });
            }
        }

        // Lưu câu hỏi
        saveQuestionEl.addEventListener("click", function () {
            let check = true;

            // Validate câu hỏi: không trống
            if (!question.content.trim()) {
                document.getElementById("question-error-empty").style.display = "block";
                check = false;
            } else {
                document.getElementById("question-error-empty").style.display = "none";
            }

            // Validate câu hỏi: độ dài 3-100 ký tự
            if (question.content.length < 3 || question.content.length > 100) {
                document.getElementById("question-error-length").style.display = "block";
                check = false;
            } else {
                document.getElementById("question-error-length").style.display = "none";
            }

            // Validate số lượng câu trả lời: ít nhất 2 câu
            if (question.answers.length < 2) {
                document.getElementById("answer-error-min").style.display = "block";
                check = false;
            } else {
                document.getElementById("answer-error-min").style.display = "none";
            }

            // Validate câu trả lời: không trống
            let answerEmpty = false;
            for (let i = 0; i < question.answers.length; i++) {
                if (!question.answers[i].answer.trim()) {
                    answerEmpty = true;
                    break;
                }
            }
            if (answerEmpty) {
                document.getElementById("answer-error-empty").style.display = "block";
                check = false;
            } else {
                document.getElementById("answer-error-empty").style.display = "none";
            }

            // Validate câu trả lời: độ dài 3-100 ký tự
            let answerLengthInvalid = false;
            for (let i = 0; i < question.answers.length; i++) {
                if (question.answers[i].answer.length < 3 || question.answers[i].answer.length > 100) {
                    answerLengthInvalid = true;
                    break;
                }
            }
            if (answerLengthInvalid) {
                document.getElementById("answer-error-length").style.display = "block";
                check = false;
            } else {
                document.getElementById("answer-error-length").style.display = "none";
            }

            // Validate ít nhất 1 câu trả lời đúng
            let hasCorrectAnswer = false;
            for (let i = 0; i < question.answers.length; i++) {
                if (question.answers[i].isCorrected) {
                    hasCorrectAnswer = true;
                    break;
                }
            }
            if (!hasCorrectAnswer) {
                document.getElementById("answer-error-correct").style.display = "block";
                check = false;
            } else {
                document.getElementById("answer-error-correct").style.display = "none";
            }

            if (!check) return;

            // Lưu câu hỏi
            if (editIndex === -1) {
                questionList.push(question);
            } else {
                questionList[editIndex] = {
                    content: question.content,
                    answers: []
                };
                for (let j = 0; j < question.answers.length; j++) {
                    questionList[editIndex].answers.push({
                        answer: question.answers[j].answer,
                        isCorrected: question.answers[j].isCorrected
                    });
                }
                editIndex = -1;
            }

            contentQuestionEl.value = "";
            question = {
                content: "",
                answers: []
            };
            renderAnswers();
            renderTestListQuestion();
            const modalElement = document.getElementById("questionModal");
            const modal = bootstrap.Modal.getInstance(modalElement);
            modal.hide();
        });

        // Lưu bài test
        btnSaveTestEl.addEventListener("click", function () {
            let check = true;

            // Validate testName: không trống
            if (!test.testName.trim()) {
                document.getElementById("name-error-empty").style.display = "block";
                check = false;
            } else {
                document.getElementById("name-error-empty").style.display = "none";
            }

            // Validate testName: độ dài 3-50 ký tự
            if (test.testName.length < 3 || test.testName.length > 50) {
                document.getElementById("name-error-length").style.display = "block";
                check = false;
            } else {
                document.getElementById("name-error-length").style.display = "none";
            }

            // Validate testName: không trùng
            let nameDuplicate = false;
            for (let i = 0; i < testList.length; i++) {
                if (testList[i].testName === test.testName && testList[i].id !== test.id) {
                    nameDuplicate = true;
                    break;
                }
            }
            if (nameDuplicate) {
                document.getElementById("name-error-duplicate").style.display = "block";
                check = false;
            } else {
                document.getElementById("name-error-duplicate").style.display = "none";
            }

            // Validate category: không trống
            if (test.categoryId === -1) {
                document.getElementById("category-error-empty").style.display = "block";
                check = false;
            } else {
                document.getElementById("category-error-empty").style.display = "none";
            }

            // Validate time: > 0
            if (test.playTime <= 0) {
                document.getElementById("time-error-positive").style.display = "block";
                check = false;
            } else {
                document.getElementById("time-error-positive").style.display = "none";
            }

            // Validate time: <= 120
            if (test.playTime > 120) {
                document.getElementById("time-error-max").style.display = "block";
                check = false;
            } else {
                document.getElementById("time-error-max").style.display = "none";
            }

            // Validate questionList: ít nhất 1 câu hỏi
            if (questionList.length === 0) {
                document.getElementById("question-error-min").style.display = "block";
                check = false;
            } else {
                document.getElementById("question-error-min").style.display = "none";
            }

            if (!check) return;

            // Lưu bài test
            if (testEdit) {
                let index = -1;
                for (let i = 0; i < testList.length; i++) {
                    if (testList[i].id === test.id) {
                        index = i;
                        break;
                    }
                }
                if (index !== -1) {
                    test.questions = questionList;
                    testList[index] = test;
                }
            } else {
                if (testList.length === 0) {
                    test.id = 1;
                } else {
                    test.id = testList[testList.length - 1].id + 1;
                }
                test.questions = questionList;
                testList.push(test);
            }

            saveLocal();
            localStorage.removeItem("testEdit");
            test = {
                id: -1,
                testName: "",
                categoryId: -1,
                playTime: 0,
                playAmount: 5,
                questions: []
            };
            questionList = [];
            testNameEl.value = "";
            categoryTestEl.value = "";
            timeEl.value = "";
            document.querySelector("h2").textContent = "Create the test";
            renderTestListQuestion();
        });

        // Lắng nghe sự kiện điều hướng
        categoryEl.addEventListener("click", function (e) {
            window.location.href = "../pages/categoryManagement.html";
        });

        theTestEl.addEventListener("click", function (e) {
            window.location.href = "../pages/testManagement1.html";
        });

        logOutEl.addEventListener("click", function (e) {
            localStorage.removeItem("isLoggedIn");
            window.location.href = "../pages/login.html";
        });














        
            document.getElementById('save-question').addEventListener('click', () => {
                const questionErrorEmp = document.getElementById("question-error-emp");
                const questionErrorLength = document.getElementById("question-error-length");
                const answerErrorMin = document.getElementById("answer-error-min");
                const answerErrorEmp = document.getElementById("answer-error-emp");
                const answerErrorLength = document.getElementById("answer-error-length");
                const answerErrorCorrect = document.getElementById("answer-error-correct");

                let check = true;

                // Kiểm tra câu hỏi: không trống
                if (!question.content.trim()) {
                    questionErrorEmp.style.display = "block";
                    check = false;
                }

                // Kiểm tra câu hỏi: độ dài 1-50 ký tự
                if (question.content.length < 1 || question.content.length > 50) {
                    questionErrorLength.style.display = "block";
                    check = false;
                }

                // Kiểm tra số lượng câu trả lời: ít nhất 2 câu
                if (question.answers.length < 2) {
                    answerErrorMin.style.display = "block";
                    check = false;
                }

                // Kiểm tra câu trả lời: không trống
                let answerEmpty = false;
                for (let i = 0; i < question.answers.length; i++) {
                    if (!question.answers[i].answer.trim()) {
                        answerEmpty = true;
                        break;
                    }
                }
                if (answerEmpty) {
                    answerErrorEmp.style.display = "block";
                    check = false;
                }

                // Kiểm tra câu trả lời: độ dài 1-50 ký tự
                let answerLengthInvalid = false;
                for (let i = 0; i < question.answers.length; i++) {
                    if (question.answers[i].answer.length < 1 || question.answers[i].answer.length > 50) {
                        answerLengthInvalid = true;
                        break;
                    }
                }
                if (answerLengthInvalid) {
                    answerErrorLength.style.display = "block";
                    check = false;
                }

                // Kiểm tra ít nhất 1 câu trả lời đúng
                let hasCorrectAnswer = false;
                for (let i = 0; i < question.answers.length; i++) {
                    if (question.answers[i].isCorrected) {
                        hasCorrectAnswer = true;
                        break;
                    }
                }
                if (!hasCorrectAnswer) {
                    answerErrorCorrect.style.display = "block";
                    check = false;
                }

                if (!check) return;

                // Lưu câu hỏi nếu không có lỗi
                if (editIndex === -1) {
                    questionList.push(question);
                } else {
                    questionList[editIndex] = {
                        content: question.content,
                        answers: []
                    };
                    for (let j = 0; j < question.answers.length; j++) {
                        questionList[editIndex].answers.push({
                            answer: question.answers[j].answer,
                            isCorrected: question.answers[j].isCorrected
                        });
                    }
                    editIndex = -1;
                }

                document.getElementById('content-question').value = '';
                question = {
                    content: '',
                    answers: [],
                };
                renderAnswers();
                renderTestListQuestion();
                const modalElement = document.getElementById('questionModal');
                const modal = bootstrap.Modal.getInstance(modalElement);
                modal.hide();
            });








            document.getElementById('btn-save-test').addEventListener('click', () => {
                const nameErrorEmp = document.getElementById("name-error-empty");
                const nameErrorLeng = document.getElementById("name-error-length");
                const nameErrorDupli = document.getElementById("name-error-dupli");
                const cateError = document.getElementById("cate-error");
                const timeError = document.getElementById("time-error");

                let check = true;

                // Tên bài test không được trùng nhau và có độ dài xác định
                // 1. name test not empty
                // 2. name test not exist
                // 3. name test must ... length xdinh
                // Kiểm tra testName: không trống
                if (!test.testName.trim()) {
                    nameErrorEmp.style.display = "block";
                    check = false;
                }

                // Kiểm tra testName: độ dài 1-50 ký tự
                if (test.testName.length < 1 || test.testName.length > 50) {
                    nameErrorLeng.style.display = "block";
                    check = false;
                }

                // Kiểm tra testName: không trùng
                const listTestLocal = JSON.parse(localStorage.getItem('list-test') || '[]');
                let nameDuplicate = false;
                for (let i = 0; i < listTestLocal.length; i++) {
                    if (listTestLocal[i].testName === test.testName && listTestLocal[i].id !== test.id) {
                        nameDuplicate = true;
                        break;
                    }
                }
                if (nameDuplicate) {
                    nameErrorDupli.style.display = "block";
                    check = false;
                }

                // Kiểm tra category: không trống
                if (test.categoryId === -1) {
                    cateError.style.display = "block";
                    check = false;
                }

                // Kiểm tra time: > 0
                if (test.playTime <= 0) {
                    timeError.style.display = "block";
                    check = false;
                }

                // Kiểm tra questionList: ít nhất 1 câu hỏi
                if (questionList.length === 0) {
                    alert("Test must have at least 1 question"); // Tạm dùng alert vì không có thẻ <small> tương ứng
                    check = false;
                }

                if (!check) return;

                // Lưu bài test nếu không có lỗi
                if (testEdit) {
                    let index = -1;
                    for (let i = 0; i < listTestLocal.length; i++) {
                        if (listTestLocal[i].id === test.id) {
                            index = i;
                            break;
                        }
                    }
                    if (index !== -1) {
                        test.questions = questionList;
                        listTestLocal[index] = test;
                    }
                } else {
                    if (listTestLocal.length === 0) {
                        test.id = 1;
                    } else {
                        test.id = listTestLocal[listTestLocal.length - 1].id + 1;
                    }
                    test.questions = questionList;
                    listTestLocal.push(test);
                }

                localStorage.setItem('list-test', JSON.stringify(listTestLocal));
                localStorage.removeItem('testEdit');
                test = {
                    id: -1,
                    testName: "",
                    categoryId: -1,
                    playTime: 0,
                    playAmount: 5,
                    questions: []
                };
                questionList = [];
                document.getElementById('testName').value = '';
                document.getElementById('category-test').value = '';
                document.getElementById('time').value = '';
                document.querySelector('h2').textContent = "Create the test";
                renderTestListQuestion();
            });
    </script>
</body>

</html>